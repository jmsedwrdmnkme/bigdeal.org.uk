<?php
/**
 * Questions block
 *
 * @package      Synthetic
 * @author       James Monk
 * @since        1.0.0
 * @license      GPL-2.0+
**/

// disable block frontend wrapper.
add_filter( 'acf/hero/frontend_allow_wrapper', '__return_false' );
?>
<div class="questions-container position-relative">
  <div class="questions-form d-flex bg-white p-2 p-md-3 rounded-3 col-lg-8">
    <input class="form-control border-0 col ms-5" type="text" placeholder="Ask any question hereâ€¦" id="input">
    <a href="#search-results" class="btn btn-blue text-white col-auto">Search</a>
  </div>

  <div class="text-white my-5">
    <?php the_field('text'); ?>
  </div>

  <div class="wp-block-group" id="search-results">
    <div class="wp-block-group__inner-container">
      <div class="wp-block-columns">
        <div class="wp-block-column card">
          <h2 class="question-title">Top questions</h2>
          <div class="accordion accordion-flush" id="accordionQuestions">
            <?php
            $count = 0;
            if( have_rows('question') ): while ( have_rows('question') ) : the_row();
              $count++;
            ?>
              <div class="accordion-item">
                <h3 class="accordion-header mb-0" id="question-heading<?php echo '-'.$count; ?>">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#accordion-collapse<?php echo '-'.$count; ?>" aria-expanded="false" aria-controls="accordion-collapse"><?php the_sub_field('title'); ?></button>
                </h3>
                <div id="accordion-collapse<?php echo '-'.$count; ?>" class="accordion-collapse collapse" aria-labelledby="question-heading<?php echo '-'.$count; ?>" data-bs-parent="#accordionQuestions">
                  <div class="accordion-body pt-0">
                    <?php the_sub_field('text'); ?>
                  </div>
                </div>
              </div>
            <?php
              endwhile; endif;
            ?>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<style>
  @media (max-width: 991.98px) {
    .hero + .questions-container {
      margin-top: -17rem;
    }
  }

  @media (min-width: 992px) {
    .hero + .questions-container {
      margin-top: -47% !important;
    }
  }

  .questions-form {
    background-image: url("data:image/svg+xml,%3Csvg width='41' height='38' viewBox='0 0 41 38' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M27 15.5C27 21.8513 21.8513 27 15.5 27C9.14873 27 4 21.8513 4 15.5C4 9.14873 9.14873 4 15.5 4C21.8513 4 27 9.14873 27 15.5ZM25.5344 27.314C22.8305 29.6129 19.3272 31 15.5 31C6.93959 31 0 24.0604 0 15.5C0 6.93959 6.93959 0 15.5 0C24.0604 0 31 6.93959 31 15.5C31 18.791 29.9744 21.8424 28.2253 24.3521L39.6 34.1054C40.4386 34.8244 40.5355 36.087 39.8165 36.9255C39.0975 37.764 37.8349 37.8609 36.9963 37.142L25.5344 27.314Z' fill='%236D5CB8'/%3E%3C/svg%3E%0A");
    background-repeat: no-repeat;
    background-position: 1rem center;
  }
</style>

<script>
   const input = document.querySelector("#input");
   const list = document.querySelector("#accordionQuestions");
   const faqEntries = document.querySelectorAll('.accordion-item');
   const namesList = [].slice.call(faqEntries);

   input.addEventListener('keyup', (e) => {
     const match = new RegExp(`${e.target.value}`, 'gi');
     let results = namesList.filter(name => match.test(name.innerText));
     let elem = document.querySelector('.question-title');
     let searchVal = document.querySelector('#input').value;
     let target = document.querySelector('.accordion-button');
     list.innerHTML = '';

     for (let i = 0; i < results.length; i++) { 
       list.appendChild(results[i])
       let totalFaqs = i + 1;

       if (searchVal.length) {
         elem.innerText = totalFaqs + ' results for "' + searchVal + '"';
       } else {
         elem.innerText = 'Top questions';
       }
     }

     let searchResults = 0 + list.childElementCount;
     if (searchResults < 1) {
       elem.innerText = 'No results for "' + searchVal + '", please try a different term.';
     }
   });
</script>
