<?php
/**
 * Adult Hero block
 *
 * @package      Synthetic
 * @author       James Monk
 * @since        1.0.0
 * @license      GPL-2.0+
**/

$title = get_field('title');
$tagline = get_field('tagline');
$pages = get_field('pages');
$has_anchor = 'false';

// disable block frontend wrapper.
add_filter( 'acf/hero/frontend_allow_wrapper', '__return_false' );
?>
<div class="full-width adult__hero bg-indigo text-white pt-5 text-center">
  <div class="container pt-lg-4">
    <?php if( have_rows('pages') ): ?>
      <form class="row align-items-center justify-content-center">
        <select class="form-select col-md">
          <option value="" disabled selected>I am looking for information on&hellip;</option>
          <?php while( have_rows('pages') ) : the_row(); ?>
            <?php $menu_item = get_sub_field('menu_item'); ?>
            <?php $anchor_link = get_sub_field('anchor_link'); ?>
            <?php if(!$anchor_link): ?>
              <?php $id = $menu_item->ID; ?>
              <option value="<?php echo esc_url( get_page_link( $id ) ); ?>"><?php echo esc_html( $menu_item->post_title ); ?></option>
            <?php else: ?>
              <?php $has_anchor = 'true'; ?>
            <?php endif; ?>
          <?php endwhile; ?>
        </select>
        <input type="submit" class="btn btn-primary" value="Go!" class="col-auto" />
      </form>

      <?php if($has_anchor == 'true'): ?>
        <div class="row">
          <?php while( have_rows('pages') ) : the_row(); ?>
            <?php $menu_item = get_sub_field('menu_item'); ?>
            <?php $anchor_link = get_sub_field('anchor_link'); ?>
            <?php if($anchor_link): ?>
              <?php $thumbnail_image = get_sub_field('thumbnail_image'); ?>
              <?php $thumbnail_tagline = get_sub_field('thumbnail_tagline'); ?>
              <div class="col-md-6 col-lg-4 mt-4">
                <a href="#<?php echo strtolower(trim(preg_replace('/[\s-]+/', '-', preg_replace('/[^A-Za-z0-9-]+/', '-', preg_replace('/[&]/', 'and', preg_replace('/[\']/', '', iconv('UTF-8', 'ASCII//TRANSLIT', esc_html( $menu_item->post_title )))))), '-')); ?>" class="card h-100">
                  <div class="card-img-top">
                    <?php if( !empty( $thumbnail_image ) ): ?>
                      <img src="<?php echo esc_url($thumbnail_image['url']); ?>" alt="<?php echo esc_html( $menu_item->post_title ); ?>" class="img-fluid mx-auto col-6" />
                    <?php endif; ?>
                  </div>
                  <div class="card-body">
                    <div class="card-title">
                      <?php echo esc_html( $menu_item->post_title ); ?>
                    </div>
                    <div class="card-text">
                      <?php echo $thumbnail_tagline; ?>
                    </div>
                  </div>
                </a>
              </div>
            <?php endif; ?>
          <?php endwhile; ?>
        </div>
      <?php endif; ?>
    <?php endif; ?>
  </div>
</div>
