<?php
/**
 * Adult Hero block
 *
 * @package      Synthetic
 * @author       James Monk
 * @since        1.0.0
 * @license      GPL-2.0+
**/

$title = get_field('title');
$tagline = get_field('tagline');
$pages = get_field('pages');
$has_anchor = 'false';

// disable block frontend wrapper.
add_filter( 'acf/hero/frontend_allow_wrapper', '__return_false' );
?>
<div class="full-width adult__hero bg-indigo text-white pt-5 text-center">
  <div class="container pt-lg-4">
    <?php if( have_rows('pages') ): ?>
      <select class="form-select">
        <?php while( have_rows('pages') ) : the_row(); ?>
          <?php $menu_item = get_sub_field('menu_item'); ?>
          <?php $anchor_link = get_sub_field('anchor_link'); ?>
          <?php if(!$anchor_link): ?>
              <option value="<?php echo esc_html( $menu_item->post_url ); ?>"><?php echo esc_html( $menu_item->post_title ); ?></option>
          <?php else: ?>
            <?php $has_anchor = 'true'; ?>
          <?php endif; ?>
        <?php endwhile; ?>
      </select>

      <?php if($has_anchor == 'true'): ?>
        <div class="row">
          <?php while( have_rows('pages') ) : the_row(); ?>
            <?php $menu_item = get_sub_field('menu_item'); ?>
            <?php $anchor_link = get_sub_field('anchor_link'); ?>
            <?php if($anchor_link): ?>
              <?php $thumbnail_image = get_sub_field('thumbnail_image'); ?>
              <?php $thumbnail_tagline = get_sub_field('thumbnail_tagline'); ?>
              <a href="#<?php echo strtolower(trim(preg_replace('/[\s-]+/', '-', preg_replace('/[^A-Za-z0-9-]+/', '-', preg_replace('/[&]/', 'and', preg_replace('/[\']/', '', iconv('UTF-8', 'ASCII//TRANSLIT', esc_html( $menu_item->post_title )))))), '-')); ?>" class="card col-md-6 col-lg-4 mt-4">
                <div class="card-img-top">
                  <img src="<?php echo $thumbnail_image; ?>" alt="" class="img-fluid mx-auto">
                </div>
                <div class="card-body">
                  <div class="card-text">
                    <?php echo $thumbnail_tagline; ?>
                  </div>
                </div>
              </a>
            <?php endif; ?>
          <?php endwhile; ?>
        </div>
      <?php endif; ?>
    <?php endif; ?>
  </div>
</div>
